/*!
  * Valentine: JavaScript's functional Sister
  * (c) Dustin Diaz 2013
  * https://github.com/ded/valentine
  * License MIT
  */
(function(e,t,n){typeof module!="undefined"?module.exports=n():typeof define=="function"?define(n):t[e]=t.v=n()})("valentine",this,function(){function p(e){this.values=e,this.index=0}function d(e,t){return new m(e,t)}function v(e,t){for(var n in t)e[n]=t[n]}function m(e,t){this.val=e,this._scope=t||i,this._chained=0}var e=this,t=e.v,n=[],r=Object.prototype.hasOwnProperty,i=null,s=n.slice,o="map"in n,u="reduce"in n,a=/(^\s*|\s*$)/g,f={each:o?function(e,t,r){n.forEach.call(e,t,r)}:function(e,t,n){for(var r=0,i=e.length;r<i;r++)r in e&&t.call(n,e[r],r,e)},map:o?function(e,t,r){return n.map.call(e,t,r)}:function(e,t,n){var r=[],i;for(i=0,l=e.length;i<l;i++)i in e&&(r[i]=t.call(n,e[i],i,e));return r},some:o?function(e,t,n){return e.some(t,n)}:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e))return!0;return!1},every:o?function(e,t,n){return e.every(t,n)}:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(r in e&&!t.call(n,e[r],r,e))return!1;return!0},filter:o?function(e,t,n){return e.filter(t,n)}:function(e,t,n){for(var r=[],i=0,s=0,o=e.length;i<o;i++)if(i in e){if(!t.call(n,e[i],i,e))continue;r[s++]=e[i]}return r},indexOf:o?function(e,t,n){return e.indexOf(t,isFinite(n)?n:0)}:function(e,t,n){n=n||0,n=n<0?0:n,n=n>e.length?e.length:n;for(var r=n;r<e.length;r++)if(r in e&&e[r]===t)return r;return-1},lastIndexOf:o?function(e,t,n){return e.lastIndexOf(t,isFinite(n)?n:e.length)}:function(e,t,n){n=n||e.length,n=n>=e.length?e.length:n<0?e.length+n:n;for(var r=n;r>=0;--r)if(r in e&&e[r]===t)return r;return-1},reduce:u?function(e,t,r,i){return n.reduce.call(e,t,r,i)}:function(e,t,n,r){e||(e=[]);var i=0,s=e.length;if(arguments.length<3)do{if(i in e){n=e[i++];break}if(++i>=s)throw new TypeError("Empty array")}while(1);for(;i<s;i++)i in e&&(n=t.call(r,n,e[i],i,e));return n},reduceRight:u?function(e,t,r,i){return n.reduceRight.call(e,t,r,i)}:function(e,t,n,r){!e&&(e=[]);var i=e.length,s=i-1;if(arguments.length<3)do{if(s in e){n=e[s--];break}if(--s<0)throw new TypeError("Empty array")}while(1);for(;s>=0;s--)s in e&&(n=t.call(r,n,e[s],s,e));return n},find:function(e,t,n){var r;return f.some(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},reject:function(e,t,n){var r=[];for(var i=0,s=0,o=e.length;i<o;i++)if(i in e){if(t.call(n,e[i],i,e))continue;r[s++]=e[i]}return r},size:function(e){return h.toArray(e).length},compact:function(e){return f.filter(e,function(e){return!!e})},flatten:function(e){return f.reduce(e,function(e,t){return c.arr(t)?e.concat(f.flatten(t)):(e[e.length]=t,e)},[])},uniq:function(e,t){var n=[],r,i;e=t?f.map(e,t):e;e:for(r=0;r<e.length;r++){for(i=0;i<n.length;i++)if(n[i]===e[r])continue e;n[n.length]=e[r]}return n},merge:function(e,t){var n=e.length,r=0,i;if(isFinite(t.length))for(i=t.length;r<i;r++)e[n++]=t[r];else while(t[r]!==undefined)first[n++]=second[r++];return e.length=n,e},inArray:function(e,t){return!!~f.indexOf(e,t)},memo:function(e,t){var n={};return t||(t=function(e){return e}),function(){var i=t.apply(this,arguments);return r.call(n,i)?n[i]:n[i]=e.apply(this,arguments)}}},c={fun:function(e){return typeof e=="function"},str:function(e){return typeof e=="string"},ele:function(e){return!!e&&!!e.nodeType&&e.nodeType==1},arr:function(e){return e instanceof Array},arrLike:function(e){return e&&e.length&&isFinite(e.length)},num:function(e){return typeof e=="number"},bool:function(e){return e===!0||e===!1},args:function(e){return!!e&&!!r.call(e,"callee")},emp:function(e){var t=0;return c.arr(e)?e.length===0:c.obj(e)?function(){for(var n in e){t++;break}return t===0}():e===""},dat:function(e){return!!(e&&e.getTimezoneOffset&&e.setUTCFullYear)},reg:function(e){return!(!(e&&e.test&&e.exec)||!e.ignoreCase&&e.ignoreCase!==!1)},nan:function(e){return e!==e},nil:function(e){return e===i},und:function(e){return typeof e=="undefined"},def:function(e){return typeof e!="undefined"},obj:function(e){return e instanceof Object&&!c.fun(e)&&!c.arr(e)}};c.empty=c.emp,c.date=c.dat,c.regexp=c.reg,c.element=c.ele,c.array=c.arr,c.string=c.str,c.undef=c.und,c.func=c.fun;var h={each:function(t,n,i){c.arrLike(t)?f.each(t,n,i):function(){for(var e in t)r.call(t,e)&&n.call(i,e,t[e],t)}()},map:function(t,n,i){var s=[],o=0;return c.arrLike(t)?f.map(t,n,i):!function(){for(var e in t)r.call(t,e)&&(s[o++]=n.call(i,e,t[e],t))}()&&s},some:function(t,n,i){if(c.arrLike(t))return f.some(t,n,i);for(var s in t)if(r.call(t,s)&&n.call(i,s,t[s],t))return!0;return!1},every:function(t,n,i){if(c.arrLike(t))return f.every(t,n,i);for(var s in t)if(!r.call(t,s)||!n.call(i,s,t[s],t))return!1;return!0},filter:function(t,n,i){var s={},o;if(c.arrLike(t))return f.filter(t,n,i);for(o in t)r.call(t,o)&&n.call(i,o,t[o],t)&&(s[o]=t[o]);return s},pluck:function(t,n){return c.arrLike(t)?f.map(t,function(e){return e[n]}):h.map(t,function(e,t){return t[n]})},toArray:function(t){return t?c.arr(t)?t:t.toArray?t.toArray():c.args(t)?s.call(t):f.map(t,function(e){return e}):[]},first:function(t){return t[0]},last:function(t){return t[t.length-1]},keys:Object.keys?function(t){return Object.keys(t)}:function(t){var n=[],i;for(i in t)r.call(t,i)&&(n[n.length]=i);return n},values:function(t){return h.map(t,function(e,t){return t})},extend:function(){var t,n,r,s,o,u=arguments[0],a=1,f=arguments.length;for(;a<f;a++)if((t=arguments[a])!==i)for(n in t){r=u[n],s=t[n];if(u===s)continue;s&&c.obj(s)?(o=r&&c.obj(r)?r:{},u[n]=h.extend(o,s)):s!==undefined&&(u[n]=s)}return u},trim:String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(a,"")},bind:function(t,n){var r=arguments.length>2?s.call(arguments,2):null;return function(){return n.apply(t,r?r.concat(s.call(arguments)):arguments)}},curry:function(t){if(arguments.length==1)return t;var n=s.call(arguments,1);return function(){return t.apply(null,n.concat(s.call(arguments)))}},parallel:function(t,n){var r=h.toArray(arguments),s=0,o=[],u=[];if(c.arr(t)&&t.length===0||c.fun(t)&&r.length===1)throw new TypeError("Empty parallel array");c.arr(t)||(n=r.pop(),t=r),f.each(t,function(e,r){e(function(){var e=h.toArray(arguments),a=e.shift();if(a)return n(a);o[r]=e,t.length==++s&&(o.unshift(i),f.each(o,function(e){u=u.concat(e)}),n.apply(i,u))})})},waterfall:function(t,n){var r=h.toArray(arguments),s=0;if(c.arr(t)&&t.length===0||c.fun(t)&&r.length===1)throw new TypeError("Empty waterfall array");c.arr(t)||(n=r.pop(),t=r),function o(){var e=h.toArray(arguments);e.push(o);var r=e.shift();!r&&t.length?t.shift().apply(i,e):(e.pop(),e.unshift(r),n.apply(i,e))}(i)},queue:function(t){return new p(c.arrLike(t)?t:h.toArray(arguments))},debounce:function(t,n,r){function s(){function o(){i=null,n.apply(s,e)}var e=arguments,s=r||this;clearTimeout(i),i=setTimeout(o,t)}var i;return s.cancel=function(){clearTimeout(i),i=null},s},throttle:function(t,n,r){var i;return function(){var s=r||this,o=arguments;i||(i=setTimeout(function(){n.apply(s,o),i=null},t))}},throttleDebounce:function(e,t,n,r){function a(){i=arguments,s=r||this,clearTimeout(o),o=setTimeout(function(){clearTimeout(u),u=null,n.apply(s,i)},t),u||(u=setTimeout(function(){clearTimeout(o),u=null,n.apply(s,i)},e))}var i,s,o,u;return a.cancel=function(){clearTimeout(o),clearTimeout(u),u=null},a}};return p.prototype.next=function(){return this.index<this.values.length&&this.values[this.index++](),this},v(d,f),v(d,h),d.is=c,d.v=d,d.each(d.extend({},f,h),function(e,t){m.prototype[e]=function(){var e=d.toArray(arguments);e.unshift(this.val);var n=t.apply(this._scope,e);return this.val=n,this._chained?this:n}}),v(m.prototype,{chain:function(){return this._chained=1,this},value:function(){return this.val}}),d.noConflict=function(){return e.v=t,this},d})